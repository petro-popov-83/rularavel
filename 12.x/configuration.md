# Конфигурация {#configuration}

- [Введение](#introduction)
- [Конфигурация среды](#environment-configuration)
  - [Типы переменных окружения](#environment-variable-types)
  - [Получение параметров среды](#retrieving-environment-configuration)
  - [Определение текущей среды](#determining-the-current-environment)
  - [Шифрование файла окружения](#encrypting-environment-files)
- [Доступ к значениям конфигурации](#accessing-configuration-values)
- [Кэширование конфигурации](#configuration-caching)
- [Публикация конфигурации](#configuration-publishing)
- [Режим отладки](#debug-mode)
- [Режим обслуживания](#maintenance-mode)

## Введение {#introduction}

Все файлы конфигурации фреймворка Laravel хранятся в каталоге `config`. Каждый параметр документирован, так что можете просматривать файлы и знакомиться с доступными настройками. Эти файлы позволяют настраивать такие вещи, как параметры подключения к базе данных, настройки почтового сервера, URL‑адрес вашего приложения и ключ шифрования.


### Команда about

Laravel может выводить обзор конфигурации вашего приложения, используемых драйверов и среды с помощью Artisan‑команды `about`:

```
1 php artisan about
```

Если вас интересует только определённая секция обзора, можно отфильтровать вывод с помощью параметра `--only`:

```
php artisan about --only=environment
```

Чтобы подробнее изучить значения конкретного конфигурационного файла, используйте команду `config:show`:

```
php artisan config:show database
```

## Конфигурация среды {#environment-configuration}

Часто бывает полезно иметь различные конфигурационные значения в зависимости от среды, в которой работает приложение. Например, вы можете использовать другой драйвер кеширования локально, чем на производственном сервере. Для этого Laravel использует библиотеку [DotEnv](https://github.com/vlucas/phpdotenv). В свежей установке в корне приложения находится файл `.env.example`, содержащий многие распространённые переменные среды. Во время установки этот файл автоматически копируется в `.env`.

Файл `.env` по умолчанию содержит общие конфигурационные значения, которые могут отличаться в зависимости от того, выполняется ли ваше приложение локально или на продакшн‑сервере. Эти значения читаются конфигурационными файлами в каталоге `config` с помощью функции `env`. Если вы работаете в команде, рекомендуется продолжать включать и обновлять файл `.env.example`. Подставляя в него значения‑заглушки, другие разработчики будут видеть, какие переменные нужны для запуска приложения. Любую переменную из файла `.env` можно переопределить внешними, например системными, переменными окружения.

### Безопасность файла окружения {#environment-file-security}

Не следует добавлять файл `.env` в систему контроля версий, так как у каждого разработчика или сервера могут быть свои значения. К тому же это рискованно — в случае доступа злоумышленника к репозиторию будут раскрыты секретные данные. Однако Laravel позволяет зашифровать файл окружения, чтобы его можно было безопасно хранить в исходниках.

### Дополнительные файлы окружения {#additional-environment-files}

Перед загрузкой переменных среды Laravel проверяет, была ли внешне передана переменная `APP_ENV` или указан аргумент CLI `--env`. В таком случае будет предпринята попытка загрузить файл `.env.[APP_ENV]`. Если его нет, загрузится обычный `.env`.

### Типы переменных окружения {#environment-variable-types}

Все значения в файлах `.env` обычно интерпретируются как строки, поэтому Laravel определяет зарезервированные значения, позволяющие возвращать из функции `env()` более широкий спектр типов:

```
.env  значение    env()  значение
true             (bool) true
(true)           (bool) true
false            (bool) false
(false)          (bool) false
empty            (string) ''
(empty)          (string) ''
null             (null) null
(null)           (null) null
```

Если необходимо определить переменную с пробелами, заключите значение в двойные кавычки, например:

```
APP_NAME="My Application"
```

### Получение параметров среды {#retrieving-environment-configuration}

Все переменные из файла `.env` загружаются в суперглобальный массив `$_ENV`, когда приложение получает запрос. Тем не менее в конфигурационных файлах обычно используется функция `env` для получения значений:

```
'debug' => env('APP_DEBUG', false),
```

Второй аргумент функции `env` — это значение по умолчанию, которое будет вернуто, если переменная окружения не определена.

### Определение текущей среды {#determining-the-current-environment}

Текущая среда приложения определяется значением `APP_ENV` в файле `.env`. Получить это значение можно с помощью фасада `App`:

```
use Illuminate\Support\Facades\App;

$environment = App::environment();
```

Метод `environment` принимает аргументы для проверки конкретных сред и вернёт `true`, если среда совпадает с одним из переданных значений:

```
if (App::environment('local')) {
    // Среда — локальная
}

if (App::environment(['local', 'staging'])) {
    // Среда — local или staging
}
```

Значение `APP_ENV` может быть переопределено внешней переменной окружения на уровне сервера.
### Шифрование файла окружения {#encrypting-environment-files}

Для защиты переменных окружения вы можете зашифровать файл `.env`. Команда:

```
php artisan env:encrypt
```

создаст зашифрованную версию файла `.env.encrypted` и удалит исходный файл `.env`. Для приложений без установленного ключа шифрования `APP_KEY` используйте опцию `--key` для передачи ключа. Чтобы расшифровать файл, выполните:

```
php artisan env:decrypt
```

Для указания конкретного файла окружения используйте параметр `--env=<имя файла>`.

### Доступ к значениям конфигурации {#accessing-configuration-values}

Все параметры, определённые в файлах каталога `config`, можно получать с помощью фасада `Config` или глобальной функции `config()`. Например, чтобы получить текущий часовой пояс приложения, используйте:

```php
use Illuminate\Support\Facades\Config;

$timezone = Config::get('app.timezone');
```

Вы можете применять точечную нотацию для доступа к вложенным значениям: `config('app.timezone')`. Второй аргумент функции `config()` позволяет указать значение по умолчанию, которое будет вернуто, если ключ отсутствует: `config('app.debug', false)`.

Laravel также предоставляет типобезопасные методы: `Config::string()`, `Config::int()`, `Config::float()`, `Config::bool()`, `Config::array()` и `Config::collect()`. Они возвращают значения нужного типа или выбрасывают исключение, если значение не может быть приведено к ожидаемому типу.

### Кэширование конфигурации {#configuration-caching}

Для повышения производительности рекомендуется закэшировать конфигурацию. Команда:

```
php artisan config:cache
```

объединит все файлы из каталога `config` в один сериализованный файл, который будет загружаться значительно быстрее. После кэширования конфигурации не используйте функцию `env()` вне файлов конфигурации, так как Laravel обращается только к сохранённому кэшу. Чтобы очистить кэш, выполните:

```
php artisan config:clear
```

### Публикация конфигурации {#configuration-publishing}

Многие сторонние пакеты поставляют свои файлы конфигурации. Чтобы опубликовать файл конфигурации пакета в каталог `config` вашего приложения, выполните:

```
php artisan vendor:publish --tag=config
```

Если необходимо опубликовать все доступные файлы конфигурации, воспользуйтесь флагом `--all`.

### Режим отладки {#debug-mode}

Флаг `APP_DEBUG` в файле `.env` управляет режимом отладки Laravel. Когда `APP_DEBUG=true`, при ошибке приложение отображает подробную информацию, включая стек вызовов и переменные. В продакшене это значение должно быть `false`, чтобы не раскрывать конфиденциальные данные.

### Режим обслуживания {#maintenance-mode}

Для перевода приложения в режим обслуживания используйте Artisan-команду:

```
php artisan down
```

По умолчанию эта команда будет возвращать статус 503 для всех входящих запросов. Вы можете настроить поведение с помощью параметров:

- `--refresh=60` — автоматически обновляет страницу обслуживания каждые 60 секунд.
- `--retry=60` — возвращает заголовок `Retry-After` с указанным числом секунд.
- `--secret=токен` — создаёт секретный URL, позволяющий обойти режим обслуживания.
- `--render="errors::503"` — отображает указанный Blade-шаблон в режиме обслуживания.
- `--redirect=/maintenance` — перенаправляет пользователей на другой URL.

Чтобы вывести приложение из режима обслуживания, выполните `php artisan up`.

Для многосерверных развёртываний Laravel поддерживает централизованное хранение состояния обслуживания. Установите `APP_MAINTENANCE_DRIVER=cache` и определите хранилище через `APP_MAINTENANCE_STORE`, чтобы режим обслуживания распространялся на все серверы.

