# Жизненный цикл запросов {#lifecycle}

- [Введение](#introduction)
- [Начальная загрузка](#request-lifecycle-overview)
- [HTTP-ядро](#http-kernel)
- [Провайдеры сервисов](#service-providers)
- [Маршрутизация](#routing)
- [Middleware](#middleware)
- [Обработка ответа](#responses)
- [Консольный цикл](#console-lifecycle)

## Введение {#introduction}

Понимание жизненного цикла Laravel помогает лучше использовать фреймворк и расширять его. Каждый запрос проходит через серию
этапов: загрузку, регистрацию сервисов, обработку маршрута, выполнение посредников, формирование ответа.

## Начальная загрузка {#request-lifecycle-overview}

Запрос поступает в `public/index.php`, который загружает автозагрузчик Composer и создаёт экземпляр приложения через
`bootstrap/app.php`. Здесь регистрируются важные сервисы и настраивается обработчик запросов.

## HTTP-ядро {#http-kernel}

Класс `App\Http\Kernel` определяет глобальные middleware, группы `web` и `api`, а также middleware, которые можно назначать
маршрутам. Метод `handle` ядра принимает `Request`, передаёт его по конвейеру посредников и возвращает `Response`.

## Провайдеры сервисов {#service-providers}

Провайдеры перечислены в `bootstrap/providers.php`. При запуске они регистрируют службы в контейнере, события, слушателей и
маршруты. Метод `register` выполняется всегда, а `boot` — после загрузки всех провайдеров.

## Маршрутизация {#routing}

После инициализации ядра Laravel передаёт запрос маршрутизатору. Он сопоставляет URI и метод запроса с маршрутом, определённым в
`routes/web.php` или `routes/api.php`. Затем создаётся контроллер или выполняется замыкание.

## Middleware {#middleware}

Посредники выполняются до и после обработки запроса. Они могут изменять запрос, перенаправлять пользователя, проверять доступ,
поддерживать сессии. После прохождения всех посредников запрос достигает контроллера.

## Обработка ответа {#responses}

Ответ контроллера возвращается через тот же конвейер посредников, после чего отправляется клиенту. Laravel выполняет завершающие
действия (закрытие сессии, сохранение логов). На этом жизненный цикл запроса завершается.

## Консольный цикл {#console-lifecycle}

Команды Artisan используют `App\Console\Kernel`, который регистрирует команды и планировщик. Жизненный цикл консольных команд
аналогичен HTTP: приложение загружается, провайдеры регистрируются, выполняется команда, после чего приложение завершает работу.
