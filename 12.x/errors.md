# Обработка ошибок {#errors}

- [Введение](#introduction)
- [Конфигурирование обработчика](#configuration)
- [Типы ошибок](#types-of-errors)
  - [HTTP-исключения](#http-exceptions)
  - [404 и другие страницы](#rendering-error-pages)
- [Журналирование](#logging)
- [Отчёт об ошибках](#reporting)
- [Пользовательские исключения](#custom-exceptions)
- [Валидационные ошибки](#validation-exceptions)
- [Ошибки в консоли](#errors-in-console)
- [Тестирование ошибок](#testing)

## Введение {#introduction}

Laravel поставляется с централизованным обработчиком ошибок `App\Exceptions\Handler`. Он отвечает за регистрацию и отчёт о
исключениях, а также за отображение страниц ошибок в браузере.

## Конфигурирование обработчика {#configuration}

Метод `register` класса `Handler` позволяет зарегистрировать коллбеки `reportable` и `renderable`, которые будут вызываться при
возникновении исключений определённых типов. Вы можете использовать метод `shouldReport`, чтобы исключить незначительные ошибки
из журналирования.

## Типы ошибок {#types-of-errors}

### HTTP-исключения {#http-exceptions}

Laravel предоставляет исключения `HttpException` и вспомогательный метод `abort()` для генерации ошибок с определённым статусом:

```php
abort(403);
abort(404, 'Страница не найдена');
```

### 404 и другие страницы {#rendering-error-pages}

Создайте шаблоны `resources/views/errors/404.blade.php`, `500.blade.php` и т. д. Для динамического контента можно использовать
переменную `$exception`. В режиме разработки Laravel отображает подробный стек-трейс через Symfony ErrorRenderer.

## Журналирование {#logging}

Система логирования настраивается в `config/logging.php`. Используйте каналы `stack`, `single`, `daily`, `papertrail`, `slack`.
Метод `report` в исключениях позволяет отправлять дополнительные данные в логи.

## Отчёт об ошибках {#reporting}

Метод `reportable` в обработчике позволяет регистрировать анонимные функции для отправки уведомлений (Slack, Bugsnag, Sentry).
Используйте фасад `Log` или сервисы уведомлений. Исключения, реализующие интерфейс `ShouldReport`, автоматически попадают в отчет.

## Пользовательские исключения {#custom-exceptions}

Создайте собственные исключения командой `php artisan make:exception InvalidOrderException`. Внутри класса вы можете определить
собственный метод `report` или `render`, чтобы кастомизировать обработку.

## Валидационные ошибки {#validation-exceptions}

При вызове `$request->validate()` Laravel выбрасывает `ValidationException`, который автоматически перенаправляет пользователя на
предыдущую страницу с флеш-сообщениями. Для API используйте `throw ValidationException::withMessages([...])`.

## Ошибки в консоли {#errors-in-console}

Команды Artisan автоматически выводят сообщение об ошибке. Используйте `$this->error()` для пользовательских сообщений. Исключения
будут отображены и вернут ненулевой код завершения.

## Тестирование ошибок {#testing}

В тестах вы можете ожидать исключение с помощью `->assertThrows()` или `->expectException()`. Используйте `withoutExceptionHandling()`,
чтобы увидеть полный стек-трейс во время разработки тестов.
